---
title: "OECD city data"
author: "Oliver Bott"
date: "Saturday, November 01, 2014"
output: html_document
---


```{r include=FALSE}
# Set working directory. Change as needed
setwd('C:/Users/a6p/Desktop/Uni 2014/E1161 - Collaborative Research/GitHub Clone/Assignment3/')
```

# Methodology

We obtain the patent data on the city level from the OECD database. The R [@CiteR] package [@RSDMX] necessary for obtaining the OECD dataset.

```{r include=FALSE}
# Install packages to pull OECD data

# install.packages("devtools")
require("devtools")
library("rsdmx")
```

In the next step we pull the OECD data from the online database using [@RSDMX]. As we are interested in patent data, we work with data indicating the PCT patent applications per 10,000 inhabitants. We are also interested in the population numbers and GDP.

```{r include=FALSE}
# Pull OECD city patent data
dataURL <- "http://stats.oecd.org/restsdmx/sdmx.ashx/GetData/CITIES/AT001+AT002+AT003+BE001+BE002+BE003+BE005+CAN01+CAN04+CAN06+CAN09+CAN16+CAN20+CAN21+CAN26+CAN29+CH001+CH002+CH003+CL010+CL011+CL020+CZ001+CZ002+CZ003+DE001+DE002+DE003+DE004+DE005+DE006+DE007+DE008+DE009+DE010+DE011+DE012+DE013+DE014+DE015+DE027+DE033+DE034+DE035+DE040+DE501+DE502+DE504+DE507+DK001+EE001+ES001+ES002+ES003+ES004+ES005+ES006+ES008+ES019+FI001+FR001+FR003+FR004+FR006+FR007+FR008+FR009+FR010+FR011+FR013+FR026+FR032+FR203+FR205+FR215+GR001+GR002+HU001+IE001+IT001+IT002+IT003+IT004+IT005+IT006+IT007+IT008+IT009+IT010+IT011+JP003+JP013+JP015+JP020+JP021+JP023+JP024+JP025+JP026+JP030+JP031+JP034+JP036+JP038+JP039+JP040+JP042+JP046+JP047+JP048+JP050+JP051+JP052+JP053+JP054+JP055+JP059+JP064+JP065+JP066+JP067+JP071+JP074+JP075+JP077+JP078+KR004+KR015+KR018+KR022+KR025+KR026+KR029+KR032+KR033+KR035+MEX01+MEX02+MEX05+MEX08+MEX10+MEX16+MEX19+MEX20+MEX21+MEX22+MEX24+MEX28+MEX29+MEX31+MEX33+MEX34+MEX35+MEX37+MEX38+MEX40+MEX42+MEX46+MEX50+MEX51+MEX52+MEX55+MEX59+MEX60+MEX61+MEX70+MEX73+MEX74+MEX75+NL001+NL002+NL003+NL004+NL005+NO001+PL001+PL002+PL003+PL004+PL005+PL006+PL009+PL010+PT001+PT002+SE001+SE002+SE003+SI001+SK001+UK001+UK002+UK003+UK004+UK005+UK006+UK007+UK008+UK009+UK010+UK011+UK017+UK023+UK097+UK098+US003+US012+US014+US033+US035+US038+US039+US044+US045+US048+US055+US060+US065+US069+US070+US077+US081+US084+US089+US097+US103+US106+US107+US114+US115+US117+US122+US124+US125+US128+US133+US134+US135+US141+US146+US147+US149+US154+US155+US159+US160+US161+US170+US174+US178+US180+US181+US186+US190+US195+US196+US202+US205+US209+US210+US212+US213+US223+US227+US233+US234+US237+US241+US242+US245+US250+US251+US252+US259+US261.PCT_INTENSITY?startTime=2008&endTime=2012"

sdmx <- readSDMX(dataURL)
city_pat <- as.data.frame(sdmx)

# Clean table by deleting and renaming rows
city_pat$VAR <- NULL # Delete columns
city_pat$attrs.df <- NULL

colnames(city_pat) <- c("METRO_ID" , "Year" , "Patent_Intensity") # Rename columns

# Pull OECD GDP per capita data

dataURL2 <- "http://stats.oecd.org/restsdmx/sdmx.ashx/GetData/CITIES/AT001+AT002+AT003+BE001+BE002+BE003+BE005+CAN01+CAN04+CAN06+CAN09+CAN16+CAN20+CAN21+CAN26+CAN29+CH001+CH002+CH003+CL010+CL011+CL020+CZ001+CZ002+CZ003+DE001+DE002+DE003+DE004+DE005+DE006+DE007+DE008+DE009+DE010+DE011+DE012+DE013+DE014+DE015+DE027+DE033+DE034+DE035+DE040+DE501+DE502+DE504+DE507+DK001+EE001+ES001+ES002+ES003+ES004+ES005+ES006+ES008+ES019+FI001+FR001+FR003+FR004+FR006+FR007+FR008+FR009+FR010+FR011+FR013+FR026+FR032+FR203+FR205+FR215+GR001+GR002+HU001+IE001+IT001+IT002+IT003+IT004+IT005+IT006+IT007+IT008+IT009+IT010+IT011+JP003+JP013+JP015+JP020+JP021+JP023+JP024+JP025+JP026+JP030+JP031+JP034+JP036+JP038+JP039+JP040+JP042+JP046+JP047+JP048+JP050+JP051+JP052+JP053+JP054+JP055+JP059+JP064+JP065+JP066+JP067+JP071+JP074+JP075+JP077+JP078+KR004+KR015+KR018+KR022+KR025+KR026+KR029+KR032+KR033+KR035+MEX01+MEX02+MEX05+MEX08+MEX10+MEX16+MEX19+MEX20+MEX21+MEX22+MEX24+MEX28+MEX29+MEX31+MEX33+MEX34+MEX35+MEX37+MEX38+MEX40+MEX42+MEX46+MEX50+MEX51+MEX52+MEX55+MEX59+MEX60+MEX61+MEX70+MEX73+MEX74+MEX75+NL001+NL002+NL003+NL004+NL005+NO001+PL001+PL002+PL003+PL004+PL005+PL006+PL009+PL010+PT001+PT002+SE001+SE002+SE003+SI001+SK001+UK001+UK002+UK003+UK004+UK005+UK006+UK007+UK008+UK009+UK010+UK011+UK017+UK023+UK097+UK098+US003+US012+US014+US033+US035+US038+US039+US044+US045+US048+US055+US060+US065+US069+US070+US077+US081+US084+US089+US097+US103+US106+US107+US114+US115+US117+US122+US124+US125+US128+US133+US134+US135+US141+US146+US147+US149+US154+US155+US159+US160+US161+US170+US174+US178+US180+US181+US186+US190+US195+US196+US202+US205+US209+US210+US212+US213+US223+US227+US233+US234+US237+US241+US242+US245+US250+US251+US252+US259+US261.GDP_PC?startTime=2008&endTime=2008"

sdmx <- readSDMX(dataURL2)
city_gdp <- as.data.frame(sdmx)

# Clean table by deleting and renaming rows
city_gdp$VAR <- NULL # Delete columns
city_gdp$attrs.df <- NULL

colnames(city_gdp) <- c("METRO_ID" , "Year" , "GDP") # Rename columns

# Pull OECD population data

dataURL3 <- "http://stats.oecd.org/restsdmx/sdmx.ashx/GetData/CITIES/AT001+AT002+AT003+BE001+BE002+BE003+BE005+CAN01+CAN04+CAN06+CAN09+CAN16+CAN20+CAN21+CAN26+CAN29+CH001+CH002+CH003+CL010+CL011+CL020+CZ001+CZ002+CZ003+DE001+DE002+DE003+DE004+DE005+DE006+DE007+DE008+DE009+DE010+DE011+DE012+DE013+DE014+DE015+DE027+DE033+DE034+DE035+DE040+DE501+DE502+DE504+DE507+DK001+EE001+ES001+ES002+ES003+ES004+ES005+ES006+ES008+ES019+FI001+FR001+FR003+FR004+FR006+FR007+FR008+FR009+FR010+FR011+FR013+FR026+FR032+FR203+FR205+FR215+GR001+GR002+HU001+IE001+IT001+IT002+IT003+IT004+IT005+IT006+IT007+IT008+IT009+IT010+IT011+JP003+JP013+JP015+JP020+JP021+JP023+JP024+JP025+JP026+JP030+JP031+JP034+JP036+JP038+JP039+JP040+JP042+JP046+JP047+JP048+JP050+JP051+JP052+JP053+JP054+JP055+JP059+JP064+JP065+JP066+JP067+JP071+JP074+JP075+JP077+JP078+KR004+KR015+KR018+KR022+KR025+KR026+KR029+KR032+KR033+KR035+MEX01+MEX02+MEX05+MEX08+MEX10+MEX16+MEX19+MEX20+MEX21+MEX22+MEX24+MEX28+MEX29+MEX31+MEX33+MEX34+MEX35+MEX37+MEX38+MEX40+MEX42+MEX46+MEX50+MEX51+MEX52+MEX55+MEX59+MEX60+MEX61+MEX70+MEX73+MEX74+MEX75+NL001+NL002+NL003+NL004+NL005+NO001+PL001+PL002+PL003+PL004+PL005+PL006+PL009+PL010+PT001+PT002+SE001+SE002+SE003+SI001+SK001+UK001+UK002+UK003+UK004+UK005+UK006+UK007+UK008+UK009+UK010+UK011+UK017+UK023+UK097+UK098+US003+US012+US014+US033+US035+US038+US039+US044+US045+US048+US055+US060+US065+US069+US070+US077+US081+US084+US089+US097+US103+US106+US107+US114+US115+US117+US122+US124+US125+US128+US133+US134+US135+US141+US146+US147+US149+US154+US155+US159+US160+US161+US170+US174+US178+US180+US181+US186+US190+US195+US196+US202+US205+US209+US210+US212+US213+US223+US227+US233+US234+US237+US241+US242+US245+US250+US251+US252+US259+US261.POP?startTime=2008&endTime=2008"

sdmx <- readSDMX(dataURL3)
city_pop <- as.data.frame(sdmx)

# Clean table by deleting and renaming rows
city_pop$VAR <- NULL # Delete columns
city_pop$attrs.df <- NULL

colnames(city_pop) <- c("METRO_ID" , "Year" , "Population") # Rename columns


# Pull OECD population density data

dataURL4 <- "http://stats.oecd.org/restsdmx/sdmx.ashx/GetData/CITIES/AT001+AT002+AT003+BE001+BE002+BE003+BE005+CAN01+CAN04+CAN06+CAN09+CAN16+CAN20+CAN21+CAN26+CAN29+CH001+CH002+CH003+CL010+CL011+CL020+CZ001+CZ002+CZ003+DE001+DE002+DE003+DE004+DE005+DE006+DE007+DE008+DE009+DE010+DE011+DE012+DE013+DE014+DE015+DE027+DE033+DE034+DE035+DE040+DE501+DE502+DE504+DE507+DK001+EE001+ES001+ES002+ES003+ES004+ES005+ES006+ES008+ES019+FI001+FR001+FR003+FR004+FR006+FR007+FR008+FR009+FR010+FR011+FR013+FR026+FR032+FR203+FR205+FR215+GR001+GR002+HU001+IE001+IT001+IT002+IT003+IT004+IT005+IT006+IT007+IT008+IT009+IT010+IT011+JP003+JP013+JP015+JP020+JP021+JP023+JP024+JP025+JP026+JP030+JP031+JP034+JP036+JP038+JP039+JP040+JP042+JP046+JP047+JP048+JP050+JP051+JP052+JP053+JP054+JP055+JP059+JP064+JP065+JP066+JP067+JP071+JP074+JP075+JP077+JP078+KR004+KR015+KR018+KR022+KR025+KR026+KR029+KR032+KR033+KR035+MEX01+MEX02+MEX05+MEX08+MEX10+MEX16+MEX19+MEX20+MEX21+MEX22+MEX24+MEX28+MEX29+MEX31+MEX33+MEX34+MEX35+MEX37+MEX38+MEX40+MEX42+MEX46+MEX50+MEX51+MEX52+MEX55+MEX59+MEX60+MEX61+MEX70+MEX73+MEX74+MEX75+NL001+NL002+NL003+NL004+NL005+NO001+PL001+PL002+PL003+PL004+PL005+PL006+PL009+PL010+PT001+PT002+SE001+SE002+SE003+SI001+SK001+UK001+UK002+UK003+UK004+UK005+UK006+UK007+UK008+UK009+UK010+UK011+UK017+UK023+UK097+UK098+US003+US012+US014+US033+US035+US038+US039+US044+US045+US048+US055+US060+US065+US069+US070+US077+US081+US084+US089+US097+US103+US106+US107+US114+US115+US117+US122+US124+US125+US128+US133+US134+US135+US141+US146+US147+US149+US154+US155+US159+US160+US161+US170+US174+US178+US180+US181+US186+US190+US195+US196+US202+US205+US209+US210+US212+US213+US223+US227+US233+US234+US237+US241+US242+US245+US250+US251+US252+US259+US261.POP_DENS?startTime=2008&endTime=2008"

sdmx <- readSDMX(dataURL3)
city_popd <- as.data.frame(sdmx)

# Clean table by deleting and renaming rows
city_popd$VAR <- NULL # Delete columns
city_popd$attrs.df <- NULL

colnames(city_popd) <- c("METRO_ID" , "Year" , "Density") # Rename columns

```

After cleaning the data frames and sorting the data, we merge the three data sets into one using the following code: 


```{r echo=TRUE}
# Merge all 3 OECD citydata sets

oecd_pat_gdp <- merge(city_pat , city_gdp , by=c("METRO_ID" , "Year"))
oecd_pat_gdp_pop <- merge(oecd_pat_gdp , city_pop , by=c("METRO_ID" , "Year"))
oecd <- merge(oecd_pat_gdp_pop , city_popd , by=c("METRO_ID" , "Year"))
```

```{r include=FALSE}
# Turn Year into numeric - WE MIGHT NOT NEED THIS - ALL ARE 2008
# sapply(oecd, mode)
# transform(oecd, Year = as.numeric(Year))
```

To further clean up the table we rename the METRO IDs and allocate the real city names.

```{r echo=FALSE}

# Clean city table, insert city and country names

oecd$METRO_ID <- replace(oecd$METRO_ID , oecd$METRO_ID == "DE001" , "Berlin")
oecd$METRO_ID <- replace(oecd$METRO_ID , oecd$METRO_ID == "DE002" , "Hamburg")
oecd$METRO_ID <- replace(oecd$METRO_ID , oecd$METRO_ID == "DE003" , "Munich")
oecd$METRO_ID <- replace(oecd$METRO_ID , oecd$METRO_ID == "DE007" , "Stuttgart")
oecd$METRO_ID <- replace(oecd$METRO_ID , oecd$METRO_ID == "DE035" , "Karlsruhe")
oecd$METRO_ID <- replace(oecd$METRO_ID , oecd$METRO_ID == "DE507" , "Aachen")

oecd$METRO_ID <- replace(oecd$METRO_ID , oecd$METRO_ID == "ES001" , "Madrid")
oecd$METRO_ID <- replace(oecd$METRO_ID , oecd$METRO_ID == "ES002" , "Barcelona")

oecd$METRO_ID <- replace(oecd$METRO_ID , oecd$METRO_ID == "FR001" , "Paris")

oecd$METRO_ID <- replace(oecd$METRO_ID , oecd$METRO_ID == "IT001" , "Rome")
oecd$METRO_ID <- replace(oecd$METRO_ID , oecd$METRO_ID == "IT002" , "Milan")
oecd$METRO_ID <- replace(oecd$METRO_ID , oecd$METRO_ID == "IT009" , "Bologna")

oecd$METRO_ID <- replace(oecd$METRO_ID , oecd$METRO_ID == "SE001" , "Stockholm")
oecd$METRO_ID <- replace(oecd$METRO_ID , oecd$METRO_ID == "SE002" , "Gothenburg")
oecd$METRO_ID <- replace(oecd$METRO_ID , oecd$METRO_ID == "SE003" , "Malmö")

oecd$METRO_ID <- replace(oecd$METRO_ID , oecd$METRO_ID == "US014" , "Minneapolis")
oecd$METRO_ID <- replace(oecd$METRO_ID , oecd$METRO_ID == "US048" , "Boston")
oecd$METRO_ID <- replace(oecd$METRO_ID , oecd$METRO_ID == "US084" , "New York")
oecd$METRO_ID <- replace(oecd$METRO_ID , oecd$METRO_ID == "US146" , "San Francisco")
oecd$METRO_ID <- replace(oecd$METRO_ID , oecd$METRO_ID == "US234" , "Austin")

```

